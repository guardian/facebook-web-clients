var guardian=guardian||{};guardian.r2=guardian.r2||{},guardian.r2.identity=guardian.r2.identity||{};var identity=identity||{};identity.facebook={},identity.httpsRoot="https://id.gucode.co.uk",jQ("<style>.identity-fb-notice {\n    border-top: 1px solid #bdbdbd;\n    float: left;\n    font-size: 14px;\n    height: 86px;\n    position: relative;\n    width: 100%;\n}\n\n.identity-fb-notice p {\n    padding-top: 23px;\n    width: 490px;\n}\n\n.identity-fb-notice .button {\n    background-color: #f3f3f3;\n    background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#f9f9f9), to(#ededed));\n    background-image: -webkit-linear-gradient(top, #f9f9f9, #ededed);\n    background-image:    -moz-linear-gradient(top, #f9f9f9, #ededed);\n    background-image:     -ms-linear-gradient(top, #f9f9f9, #ededed);\n    background-image:      -o-linear-gradient(top, #f9f9f9, #ededed);\n    border: 1px solid #cbcbcb;\n    border-radius: 5px;\n    color: #315786;\n    display: inline-block;\n    text-align: center;\n    width: 100%;\n}\n\n.identity-fb-notice .button:hover {\n    box-shadow: 0 0 5px #bdbdbd;\n    text-decoration: none;\n}\n\n.identity-fb-notice .button span {\n    background: transparent url(http://id.gucode.co.uk/static/3/cs/images/fb_icon_30.png) 8px 4px no-repeat;\n    display: block;\n    padding: 10px;\n}\n\n.identity-fb-notice .hide-bar {\n    background: transparent url(http://id.gucode.co.uk/static/3/cs/images/close.png) top left no-repeat;\n    cursor: pointer;\n    display: block;\n    height: 32px;\n    overflow: hidden;\n    position: absolute;\n    top: 0; right: 0;\n    text-indent: 100%;\n    white-space: nowrap;\n    width: 32px;\n}\n\n.identity-fb-notice .facepile {\n    border: none;\n    height: 86px;\n    overflow: hidden;\n    position: absolute;\n    top: 10px; right: 32px;\n    width: 380px;\n}</style>").appendTo("head"),guardian.r2.identity.facebookBanner=function(){var e=function(){var e=jQ.cookie("gu_facebookbar")||"",t=e.split("|");return{hidden:parseInt(t[0],10)||0,notified:t[1]==="true"||!1}},t=function(e,t){e=e||0,t=t||!1;var n=e+"|"+t;jQ.ajax({url:identity.httpsRoot+"/jsapi/dropcookie",cache:!1,crossDomain:!0,dataType:"jsonp",data:{name:"gu_facebookbar",value:n,maxage:31536e3}})},n=function(){return Math.round((new Date).getTime()/1e3)<parseInt(jQ.cookie("GU_SO"))+86400},r=function(){var e="Sign into the Guardian using your Facebook account";u("notAuthed",e,"signin")},i=function(e){var t="Welcome "+e+", sign into the Guardian with Facebook";u("noEmail",t,"signin")},s=function(n,r){jQ(".id-hide-when-signed-in").hide(),jQ(".id-populate-with-user-email").html(r.primaryEmailAddress),jQ(".id-show-when-signed-in").show(),jQ(".discussion .toolbar").each(function(){var e=jQ(this);e.hasClass("autosignedin")?e.html(e.html().replace("{name}",n)).show():e.hide()});var i="Welcome "+n+", you're signed into the Guardian using Facebook.";if(!e().notified)u("signedIn",i,"signout"),t(0,!0);else{var s=e();t(s.hidden,s.notified)}},o=function(e,t){jQ.ajax({url:identity.httpsRoot+"/jsapi/facebook/autosignup",cache:!1,crossDomain:!0,dataType:"jsonp",data:{signedRequest:e.signedRequest,accessToken:e.accessToken}}).done(t)},u=function(e,t,n){var r='<div class="identity-fb-notice" data-identifier="'+e+'"><p>',i="";if("signin"===n)i=identity.httpsRoot+"/facebook/signin?upsell=1&returnUrl="+encodeURIComponent(window.location.href.split("#")[0]),r+='<a class="button" href="'+i+'"><span>'+t+"</span></a>";else if("signout"===n){var s=identity.httpsRoot+"/signout?returnUrl="+encodeURIComponent(window.location.href.split("#")[0]);i="https://www.facebook.com/logout.php?access_token="+FB.getAuthResponse().accessToken+"&confirm=1&next="+encodeURIComponent(s),r+=t+'<br><a href="'+i+'">Click here to sign out</a>.'}var o="http://www.facebook.com/plugins/facepile.php?app_id="+identity.facebook.appId;r+='</p><span class="hide-bar">Hide</span>',"notAuthed"!==e&&(r+='<iframe class="facepile" src="'+o+'" '+'scrolling="no" frameborder="0" allowTransparency="true">'+"</iframe>"),r+="</div>",r=jQ(r).delegate(".hide-bar","click",a),jQ(".identity-fb-notice").remove(),jQ(".top-navigation").after(r)},a=function(){jQ(".identity-fb-notice").animate({opacity:0,height:0},300,function(){jQ(this).remove()});var n=jQ(this).parent().attr("data-identifier");("notAuthed"===n||"noEmail"===n)&&t(e().hidden+1)};return{notAuthed:r,noEmail:i,signedIn:s,autoSignup:o,hasUserSignedOutInLast24Hours:n,cookie:e}}(),identity.facebook.pageDomain=/^.*?\/\/([^/]*)/g.exec(document.location)[1];