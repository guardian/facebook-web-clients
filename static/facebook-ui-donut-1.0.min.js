(function(e){function t(t){this.jContainer=e(t),this.currentDp=50,this.initialise()}ensurePackage("guardian.ui"),t.prototype.jContainer=null,t.prototype.ctx=null,t.prototype.currentDp=null,t.prototype.getCanvas=function(){var e=document.createElement("canvas");return e.width=this.jContainer.width()||160,e.height=this.jContainer.height()||160,this.jContainer[0].appendChild(e),window.G_vmlCanvasManager?window.G_vmlCanvasManager.initElement(e):e},t.prototype.initialise=function(){var e=this.getCanvas();this.ctx=e.getContext("2d"),this.getCSSColours()},t.prototype.getCSSColours=function(){var n=e(".agree .count").css("background-color"),r=e(".disagree .count").css("background-color");n=="rgba(0, 0, 0, 0)"?window.setTimeout(this.getCSSColours.bind(this),50):(t.POSITIVE.stroke=n,t.NEGATIVE.disagreeColour=r,this.render())},t.prototype.setPercent=function(e){window.webkitRequestAnimationFrame?(this.targetDp=e,this.animate()):(this.currentDp=e,this.render())},t.prototype.animate=function(){var e=this.targetDp-this.currentDp;this.currentDp+=e*.1,this.render(),Math.abs(e)>.1&&window.webkitRequestAnimationFrame(this.animate.bind(this))},t.prototype.render=function(){var e=this.currentDp,n=this.ctx,r=this.jContainer.width(),i=this.jContainer.height(),s=r/2,o=i/2,u=(Math.min(r,i)-24)/2,a=Math.PI*2*((100-e)/100),f=a/2,l=u*2*Math.cos(f),c=u*2*Math.sin(f);n.clearRect(0,0,r,i),this.setStroke(e==100?t.POSITIVE:t.NEGATIVE),n.beginPath(),n.arc(s,o,u,0,Math.PI*2,!0),n.stroke(),e>0&&(this.setStroke(t.POSITIVE),n.beginPath(),n.arc(s,o,u,-f,+f,!0),n.stroke()),this.setStroke(t.NOTCH),n.beginPath(),n.moveTo(s,o),n.lineTo(s+l,o+c),n.stroke(),n.beginPath(),n.moveTo(s,o),n.lineTo(s+l,o-c),n.stroke()},t.prototype.setStroke=function(e){this.ctx.lineWidth=e["stroke-width"],this.ctx.strokeStyle=e.stroke},t.POSITIVE={stroke:"#3A7D00","stroke-width":18},t.NEGATIVE={stroke:"#0D3D00","stroke-width":18},t.NOTCH={stroke:"#fff","stroke-width":1},guardian.ui.CanvasDonut=t})(window.jQuery);